#!/bin/bash
#SBATCH --job-name=llama_3000_base
#SBATCH -A csds438                   # your account
#SBATCH -p markov_gpu                # GPU partition
#SBATCH -C gpu4090                   # RTX 4090 node
#SBATCH -N 1                         # 1 node
#SBATCH -n 1                         # 1 task
#SBATCH --gres=gpu:1                 # 1 GPU
#SBATCH --cpus-per-task=2            # 2 CPU cores
#SBATCH --mem=32G                    # 16 GB total memory
#SBATCH --time=8:00:00
#SBATCH --output=/mnt/vstor/courses/csds447/dxc830/log/llama_%j.out
#SBATCH --error=/mnt/vstor/courses/csds447/dxc830/log/llama_%j.err
#SBATCH --mail-user=dxc830@case.edu
#SBATCH --mail-type=BEGIN,END,FAIL

module load singularity

# ---- Paths ----
SIF_IMAGE=/mnt/vstor/courses/csds447/dxc830/vllm_base.sif
WORKDIR=/mnt/vstor/courses/csds447/dxc830/etfall

# ---- param ----
SAMPLE_NUM=3000

# ---- Ensure log directory exists ----
mkdir -p /mnt/vstor/courses/csds447/dxc830/log

# ---- Run job ----
cd $WORKDIR

echo "[$(date)] Starting llama 1.5B evaluation..."
singularity exec --nv $SIF_IMAGE python3 $WORKDIR/models_eval/eval_llama_1b.py --sample_number $SAMPLE_NUM --mode "base"

echo "[$(date)] Starting llama 3B evaluation..."
singularity exec --nv $SIF_IMAGE python3 $WORKDIR/models_eval/eval_llama_3b.py --sample_number $SAMPLE_NUM --mode "base"

echo "[$(date)] Starting llama 7B evaluation..."
singularity exec --nv $SIF_IMAGE python3 $WORKDIR/models_eval/eval_llama_8b.py --sample_number $SAMPLE_NUM --mode "base"

echo "[$(date)] All jobs completed successfully."
